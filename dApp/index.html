<!DOCTYPE html>
<html>
    <head>
    </head>
    <body>
        <h1>This is Lerato's first dApp!</h1>
        <p>Here we going to set or get the mood:</p>

        <label for="mood">Input Mood:</label><br>
        <input type="text" id="mood">

        <div>
            <button onclick="getMood()">Get Mood</button>
        </div>
        <div>
            <button onclick="setMood()">Set Mood</button>
        </div>

        
        <!--Connecting the solidity smart contract with the web page-->
        <script charset="utf-8" src="https://cdn.ethers.io/scripts/ethers-v4.min.js" type="text/javascript"></script>
        <script>
            //enable etherum
            window.ethereum.enable();

            //define an ethers provider
            var provider = new ethers.providers.Web3Provider(
                web3.currentProvider,
                "ropsten"
            );

            //import contract ABI and specify contract address
            var MoodContractAddress = "0x369E71897fe54e0a9Ca08Ac653a22346f75aE797";
            var MoodContractABI = [
                {
                    "inputs": [],
                    "name": "getMood",
                    "outputs": [
                        {
                            "internalType": "string",
                            "name": "",
                            "type": "string"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function",
                    "payable": false,
                    "constant": true
                },
                {
                    "inputs": [
                        {
                            "internalType": "string",
                            "name": "_mood",
                            "type": "string"
                        }
                    ],
                    "name": "setMood",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function",
                    "payable": false,
                    "constant": false
                }
            ];
            
            var MoodContract;
            var signer;

            //connect the signer to metamask account(use [0] as default), define contract object using contract address, ABI and signer
            provider.listAccounts().then(function (accounts){
                signer = provider.getSigner(accounts[0]);
                MoodContract = new ethers.Contract(
                    MoodContractAddress,
                    MoodContractABI,
                    signer
                );
            });

            //create asynchronous functions to call smart contract functions
            async function getMood(){
                getMoodPromise = MoodContract.getMood();
                var Mood = await getMoodPromise;
                console.log(Mood);
            }

            async function setMood(){
                let mood = document.getElementById("mood").value;
                setMoodPromise = MoodContract.setMood(mood);
                await setMoodPromise;
            }
        </script>
    </body>
</html>